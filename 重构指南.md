# DeepDrama çŸ­å‰§è¯„åˆ†ç³»ç»Ÿ - å®Œæ•´é‡æ„æŒ‡å—

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯
- **ç‰ˆæœ¬**: v1.0
- **é‡æ„æ—¥æœŸ**: 2025-12-17
- **æŠ€æœ¯æ ˆ**: Spring Boot 2.7 + MyBatis + Vue 3 + TypeScript + Arco Design
- **Javaç‰ˆæœ¬**: JDK 1.8 (ä¸¥æ ¼éµå®ˆ,ç¦æ­¢ä½¿ç”¨Java 9+ç‰¹æ€§)
- **è§„èŒƒä¾æ®**: `çŸ­å‰§è¯„åˆ†ç³»ç»Ÿ-å¼€å‘è§„èŒƒ.md`

---

## ğŸ¯ é‡æ„ç›®æ ‡

å°†ç°æœ‰çš„ **Hono + D1 + å•é¡µåº”ç”¨** æ¶æ„é‡æ„ä¸º:
- **åç«¯**: Spring Boot + MyBatis + MySQL
- **å‰ç«¯**: Vue 3 + TypeScript + Arco Design + Vite

---

## ğŸ“ å·¥ç¨‹ç»“æ„

```
deepdrama-refactor/
â”œâ”€â”€ backend/                          # åç«¯å·¥ç¨‹
â”‚   â”œâ”€â”€ src/main/java/com/deepdrama/
â”‚   â”‚   â”œâ”€â”€ ScoreSystemApplication.java      # å¯åŠ¨ç±»
â”‚   â”‚   â”œâ”€â”€ common/                          # å…¬å…±ç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ Result.java                  # ç»Ÿä¸€å“åº”ç»“æœ
â”‚   â”‚   â”‚   â””â”€â”€ PageResult.java              # åˆ†é¡µç»“æœ
â”‚   â”‚   â”œâ”€â”€ controller/                      # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ ScriptController.java        # å‰§æœ¬ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ RatingController.java        # è¯„åˆ†ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ DashboardController.java     # æ•°æ®çœ‹æ¿
â”‚   â”‚   â”œâ”€â”€ service/                         # æœåŠ¡å±‚æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ ScriptService.java
â”‚   â”‚   â”‚   â””â”€â”€ RatingService.java
â”‚   â”‚   â”œâ”€â”€ service/impl/                    # æœåŠ¡å±‚å®ç°
â”‚   â”‚   â”‚   â”œâ”€â”€ ScriptServiceImpl.java
â”‚   â”‚   â”‚   â””â”€â”€ RatingServiceImpl.java
â”‚   â”‚   â”œâ”€â”€ mapper/                          # Mapperæ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ ScriptMapper.java
â”‚   â”‚   â”‚   â””â”€â”€ RatingMapper.java
â”‚   â”‚   â”œâ”€â”€ entity/                          # å®ä½“ç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ Script.java
â”‚   â”‚   â”‚   â”œâ”€â”€ Rating.java
â”‚   â”‚   â”‚   â””â”€â”€ User.java
â”‚   â”‚   â”œâ”€â”€ query/                           # æŸ¥è¯¢æ¡ä»¶ç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ ScriptQuery.java
â”‚   â”‚   â”‚   â””â”€â”€ RatingQuery.java
â”‚   â”‚   â””â”€â”€ vo/                              # è§†å›¾å¯¹è±¡
â”‚   â”‚       â”œâ”€â”€ ScriptVO.java
â”‚   â”‚       â””â”€â”€ RatingVO.java
â”‚   â”œâ”€â”€ src/main/resources/
â”‚   â”‚   â”œâ”€â”€ application.yml                  # é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ mapper/                          # MyBatis XML
â”‚   â”‚       â”œâ”€â”€ ScriptMapper.xml
â”‚   â”‚       â””â”€â”€ RatingMapper.xml
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ schema.sql                       # æ•°æ®åº“ç»“æ„
â”‚   â”‚   â””â”€â”€ seed.sql                         # åˆå§‹æ•°æ®(éœ€ä»D1å¯¼å‡º)
â”‚   â””â”€â”€ pom.xml                              # Mavené…ç½®
â”‚
â””â”€â”€ frontend/                         # å‰ç«¯å·¥ç¨‹
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ main.ts                          # å…¥å£æ–‡ä»¶
    â”‚   â”œâ”€â”€ App.vue                          # æ ¹ç»„ä»¶
    â”‚   â”œâ”€â”€ router/                          # è·¯ç”±
    â”‚   â”‚   â””â”€â”€ index.ts
    â”‚   â”œâ”€â”€ views/                           # é¡µé¢ç»„ä»¶
    â”‚   â”‚   â”œâ”€â”€ Dashboard.vue                # å‰§æœ¬æ¦‚è§ˆ
    â”‚   â”‚   â”œâ”€â”€ ScriptManagement.vue         # å‰§æœ¬ç®¡ç†
    â”‚   â”‚   â”œâ”€â”€ RatingRecords.vue            # è¯„åˆ†è®°å½•
    â”‚   â”‚   â””â”€â”€ Rankings.vue                 # å‰§æœ¬æ’è¡Œ
    â”‚   â”œâ”€â”€ components/                      # é€šç”¨ç»„ä»¶
    â”‚   â”‚   â”œâ”€â”€ RatingDrawer.vue             # è¯„åˆ†å¼¹æ¡†
    â”‚   â”‚   â””â”€â”€ ScriptForm.vue               # å‰§æœ¬è¡¨å•
    â”‚   â”œâ”€â”€ api/                             # APIå°è£…
    â”‚   â”‚   â”œâ”€â”€ request.ts                   # Axioså°è£…
    â”‚   â”‚   â”œâ”€â”€ script.ts                    # å‰§æœ¬API
    â”‚   â”‚   â””â”€â”€ rating.ts                    # è¯„åˆ†API
    â”‚   â”œâ”€â”€ types/                           # TSç±»å‹å®šä¹‰
    â”‚   â”‚   â”œâ”€â”€ script.ts
    â”‚   â”‚   â””â”€â”€ rating.ts
    â”‚   â””â”€â”€ utils/                           # å·¥å…·å‡½æ•°
    â”‚       â””â”€â”€ format.ts
    â”œâ”€â”€ package.json
    â”œâ”€â”€ vite.config.ts
    â””â”€â”€ tsconfig.json
```

---

## ğŸ”§ åç«¯å¼€å‘è§„èŒƒ

### 1. Controllerå±‚è§„èŒƒ

```java
@RestController
@RequestMapping("/scripts")
@CrossOrigin(origins = "*")
public class ScriptController {
    
    @Autowired
    private ScriptService scriptService;
    
    /**
     * è·å–å‰§æœ¬åˆ—è¡¨
     * POST /api/scripts
     */
    @PostMapping
    public Result<PageResult<Script>> getScripts(@RequestBody ScriptQuery query) {
        try {
            PageResult<Script> result = scriptService.getScriptList(query);
            return Result.success(result);
        } catch (Exception e) {
            return Result.error("æŸ¥è¯¢å¤±è´¥: " + e.getMessage());
        }
    }
}
```

**å…³é”®ç‚¹**:
- âœ… ä½¿ç”¨ `@RestController` æ³¨è§£
- âœ… APIè·¯å¾„ä½¿ç”¨kebab-case: `/api/script-management`
- âœ… `@RequestBody JSONObject` æˆ– å…·ä½“Queryå¯¹è±¡
- âœ… è¿”å› `Result<T>` ç»Ÿä¸€æ ¼å¼
- âœ… å¼‚å¸¸æ•è·å¹¶è¿”å›å‹å¥½é”™è¯¯ä¿¡æ¯

### 2. Serviceå±‚è§„èŒƒ

```java
@Service
public class ScriptServiceImpl implements ScriptService {
    
    @Autowired
    private ScriptMapper scriptMapper;
    
    @Override
    @Transactional(rollbackFor = Exception.class)
    public Script createScript(JSONObject params) {
        // ä½¿ç”¨FastJSONè§£æ
        Script script = new Script();
        script.setName(params.getString("name"));
        script.setWriter(params.getString("writer"));
        // ...
        
        scriptMapper.insert(script);
        return script;
    }
}
```

**å…³é”®ç‚¹**:
- âœ… æ¥å£/å®ç°åˆ†ç¦»
- âœ… `@Transactional` ç”¨äºäº‹åŠ¡ç®¡ç†
- âœ… **å¿…é¡»ä½¿ç”¨ Alibaba FastJSON** è§£æä¸šåŠ¡é€»è¾‘
- âœ… ç¦æ­¢åœ¨ä¸šåŠ¡é€»è¾‘ä¸­æ‰‹åŠ¨ä½¿ç”¨Jackson

### 3. Mapperå±‚è§„èŒƒ

```java
@Mapper
public interface ScriptMapper {
    
    List<Script> selectList(@Param("query") ScriptQuery query);
    
    Long selectCount(@Param("query") ScriptQuery query);
    
    int insert(@Param("script") Script script);
}
```

**å…³é”®ç‚¹**:
- âœ… `@Mapper` æ³¨è§£
- âœ… å¤šä¸ªå‚æ•°å¿…é¡»ç”¨ `@Param`
- âœ… å¤æ‚SQLå†™åœ¨XMLä¸­

### 4. MyBatis XMLè§„èŒƒ

```xml
<select id="selectList" resultMap="BaseResultMap">
    SELECT * FROM scripts
    <where>
        <if test="query.keyword != null and query.keyword != ''">
            AND (name LIKE CONCAT('%', #{query.keyword}, '%'))
        </if>
        <if test="query.statuses != null and query.statuses.size() > 0">
            AND status IN
            <foreach item="item" collection="query.statuses" 
                     open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
    </where>
    ORDER BY created_at DESC
    LIMIT #{query.offset}, #{query.limit}
</select>
```

---

## ğŸ’» å‰ç«¯å¼€å‘è§„èŒƒ

### 1. ç»„ä»¶ç»“æ„è§„èŒƒ

```vue
<script setup lang="ts">
/**
 * å‰§æœ¬ç®¡ç†é¡µé¢
 * 
 * @author DeepDrama Team
 * @date 2025-12-17
 */
import { ref, reactive, computed, onMounted } from 'vue'
import { getScriptList, type Script } from '@/api/script'

// ========== çŠ¶æ€ç®¡ç†(ä¼˜å…ˆä½¿ç”¨ref) ==========
const loading = ref(false)
const tableData = ref<Script[]>([])
const queryParams = ref({
  page: 1,
  limit: 10
})

// ========== æ–¹æ³• ==========
const loadData = async () => {
  loading.value = true
  try {
    const res = await getScriptList(queryParams.value)
    if (res.success) {
      tableData.value = res.data.list
    }
  } finally {
    loading.value = false
  }
}

// ========== ç”Ÿå‘½å‘¨æœŸ ==========
onMounted(() => {
  loadData()
})
</script>

<template>
  <div class="script-management">
    <a-table :data="tableData" :loading="loading" />
  </div>
</template>

<style scoped>
.script-management {
  padding: 16px;
}
</style>
```

**å…³é”®ç‚¹**:
- âœ… **ä¸¥æ ¼ä½¿ç”¨ `<script setup lang="ts">`**
- âœ… **ç¦æ­¢ä½¿ç”¨ Options API**
- âœ… **ä¼˜å…ˆä½¿ç”¨ `ref`,é¿å…è¿‡åº¦ä½¿ç”¨ `reactive`**
- âœ… ç»„ä»¶æ–‡ä»¶åä½¿ç”¨ PascalCase
- âœ… ä½¿ç”¨ Arco Design Vue ç»„ä»¶ (`<a-xxx>`)

### 2. APIå°è£…è§„èŒƒ

```typescript
// src/api/request.ts
import axios, { AxiosInstance } from 'axios'

export interface ApiResult<T = any> {
  success: boolean
  code: number
  message: string
  data: T
}

const service: AxiosInstance = axios.create({
  baseURL: '/api',
  timeout: 30000
})

// å“åº”æ‹¦æˆªå™¨
service.interceptors.response.use(
  (response) => {
    const res = response.data
    if (!res.success) {
      Message.error(res.message)
      return Promise.reject(new Error(res.message))
    }
    return res
  }
)

export default service
```

```typescript
// src/api/script.ts
import request, { ApiResult } from './request'

export const getScriptList = (query: ScriptQuery) => {
  return request.post<ApiResult<PageResult<Script>>>('/scripts', query)
}
```

---

## ğŸ—„ï¸ æ•°æ®åº“è¿ç§»

### 1. ä»D1å¯¼å‡ºæ•°æ®

å½“å‰é¡¹ç›®ä½¿ç”¨Cloudflare D1,éœ€è¦å…ˆå¯¼å‡ºæ•°æ®:

```bash
# å¯¼å‡ºæ•°æ®åˆ°SQLæ–‡ä»¶
wrangler d1 execute deepdrama-production --local \
  --command="SELECT * FROM scripts" > scripts_export.sql

wrangler d1 execute deepdrama-production --local \
  --command="SELECT * FROM ratings" > ratings_export.sql
```

### 2. MySQLæ•°æ®åº“åˆ›å»º

```bash
# 1. åˆ›å»ºæ•°æ®åº“
mysql -u root -p < database/schema.sql

# 2. å¯¼å…¥æ•°æ®(éœ€æ‰‹åŠ¨è½¬æ¢D1å¯¼å‡ºæ ¼å¼)
mysql -u root -p deepdrama < database/seed.sql
```

### 3. å­—æ®µæ˜ å°„å¯¹ç…§

| D1å­—æ®µå | MySQLå­—æ®µå | è¯´æ˜ |
|---------|------------|------|
| script_id | script_id | å‰§æœ¬ç¼–å· |
| avg_score | avg_score | DECIMAL(5,2) |
| rating_count | rating_count | INT |
| created_at | created_at | DATETIME |

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### åç«¯éƒ¨ç½²

```bash
# 1. é…ç½®æ•°æ®åº“
vim backend/src/main/resources/application.yml
# ä¿®æ”¹æ•°æ®åº“è¿æ¥ä¿¡æ¯

# 2. Mavenæ‰“åŒ…
cd backend
mvn clean package

# 3. è¿è¡ŒjaråŒ…
java -jar target/score-system-1.0.0.jar

# åç«¯APIè¿è¡Œåœ¨: http://localhost:8080/api
```

### å‰ç«¯éƒ¨ç½²

```bash
# 1. å®‰è£…ä¾èµ–
cd frontend
npm install

# 2. å¼€å‘æ¨¡å¼
npm run dev
# è®¿é—®: http://localhost:3000

# 3. ç”Ÿäº§æ„å»º
npm run build
# è¾“å‡ºç›®å½•: dist/

# 4. éƒ¨ç½²åˆ°Nginx
cp -r dist/* /var/www/html/deepdrama/
```

---

## ğŸ“Š APIæ¥å£å¯¹ç…§è¡¨

### å‰§æœ¬ç®¡ç†

| åŠŸèƒ½ | åŸAPI(Hono) | æ–°API(Spring Boot) | æ–¹æ³• |
|------|------------|-------------------|------|
| å‰§æœ¬åˆ—è¡¨ | GET /api/scripts | POST /api/scripts | POST |
| å‰§æœ¬è¯¦æƒ… | GET /api/scripts/:id | GET /api/scripts/{id} | GET |
| åˆ›å»ºå‰§æœ¬ | POST /api/scripts | POST /api/scripts/create | POST |
| æ›´æ–°å‰§æœ¬ | PUT /api/scripts/:id | PUT /api/scripts/{id} | PUT |
| åˆ é™¤å‰§æœ¬ | DELETE /api/scripts/:id | DELETE /api/scripts/{id} | DELETE |
| å‰§æœ¬æ’è¡Œ | GET /api/rankings | GET /api/scripts/rankings | GET |

### è¯„åˆ†ç®¡ç†

| åŠŸèƒ½ | åŸAPI | æ–°API | æ–¹æ³• |
|------|------|------|------|
| è¯„åˆ†åˆ—è¡¨ | GET /api/ratings | POST /api/ratings | POST |
| åˆ›å»ºè¯„åˆ† | POST /api/ratings | POST /api/ratings/create | POST |
| æ›´æ–°è¯„åˆ† | PUT /api/ratings/:id | PUT /api/ratings/{id} | PUT |

### æ•°æ®çœ‹æ¿

| åŠŸèƒ½ | åŸAPI | æ–°API | æ–¹æ³• |
|------|------|------|------|
| KPIæŒ‡æ ‡ | GET /api/dashboard/kpi | GET /api/dashboard/kpi | GET |
| çŠ¶æ€åˆ†å¸ƒ | GET /api/dashboard/status-distribution | GET /api/dashboard/status-distribution | GET |
| æ¥æºåˆ†å¸ƒ | GET /api/dashboard/source-distribution | GET /api/dashboard/source-distribution | GET |

---

## âš ï¸ å…³é”®æ³¨æ„äº‹é¡¹

### Java 8 ä¸¥æ ¼é™åˆ¶

**ç¦æ­¢ä½¿ç”¨çš„Java 9+ç‰¹æ€§:**
```java
// âŒ ç¦æ­¢: varå…³é”®å­—(Java 10+)
var list = new ArrayList<String>();

// âœ… æ­£ç¡®: æ˜¾å¼ç±»å‹å£°æ˜
List<String> list = new ArrayList<String>();

// âŒ ç¦æ­¢: recordç±»(Java 14+)
public record Script(Long id, String name) {}

// âœ… æ­£ç¡®: ä¼ ç»Ÿç±»
public class Script {
    private Long id;
    private String name;
    // getter/setter
}

// âŒ ç¦æ­¢: æ–‡æœ¬å—(Java 13+)
String sql = """
    SELECT * FROM scripts
    """;

// âœ… æ­£ç¡®: å­—ç¬¦ä¸²æ‹¼æ¥
String sql = "SELECT * FROM scripts";
```

### FastJSONå¼ºåˆ¶è¦æ±‚

```java
// âœ… æ­£ç¡®: ä½¿ç”¨FastJSON
import com.alibaba.fastjson.JSONObject;

@PostMapping("/create")
public Result<Script> create(@RequestBody JSONObject params) {
    String name = params.getString("name");
    Integer isProject = params.getInteger("isProject");
    // ...
}

// âŒ ç¦æ­¢: ä¸šåŠ¡é€»è¾‘ä¸­æ‰‹åŠ¨Jackson
import com.fasterxml.jackson.databind.ObjectMapper;
ObjectMapper mapper = new ObjectMapper(); // ç¦æ­¢!
```

### Vue 3è§„èŒƒ

```vue
<!-- âœ… æ­£ç¡®: script setup + ref -->
<script setup lang="ts">
import { ref } from 'vue'
const count = ref(0)
</script>

<!-- âŒ ç¦æ­¢: Options API -->
<script lang="ts">
export default {
  data() {
    return { count: 0 }
  }
}
</script>

<!-- âŒ ç¦æ­¢: script + defineComponent -->
<script lang="ts">
import { defineComponent, ref } from 'vue'
export default defineComponent({
  setup() {
    const count = ref(0)
    return { count }
  }
})
</script>
```

---

## ğŸ“ æ•°æ®è¿ç§»æ¸…å•

- [ ] å¯¼å‡ºD1æ•°æ®åº“çš„ `scripts` è¡¨
- [ ] å¯¼å‡ºD1æ•°æ®åº“çš„ `ratings` è¡¨
- [ ] å¯¼å‡ºD1æ•°æ®åº“çš„ `users` è¡¨
- [ ] è½¬æ¢D1çš„DATETIMEæ ¼å¼ä¸ºMySQLæ ¼å¼
- [ ] éªŒè¯å¤–é”®å…³ç³»å®Œæ•´æ€§
- [ ] æµ‹è¯•è§¦å‘å™¨æ˜¯å¦æ­£å¸¸å·¥ä½œ

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### åç«¯æµ‹è¯•

```bash
# 1. æµ‹è¯•æ•°æ®åº“è¿æ¥
curl http://localhost:8080/api/dashboard/kpi

# 2. æµ‹è¯•å‰§æœ¬åˆ—è¡¨(POSTè¯·æ±‚)
curl -X POST http://localhost:8080/api/scripts \
  -H "Content-Type: application/json" \
  -d '{"page":1,"limit":10}'

# 3. æµ‹è¯•åˆ›å»ºå‰§æœ¬
curl -X POST http://localhost:8080/api/scripts/create \
  -H "Content-Type: application/json" \
  -d '{"scriptId":"TEST001","name":"æµ‹è¯•å‰§æœ¬","status":"ä¸€å¡åˆç¨¿"}'
```

### å‰ç«¯æµ‹è¯•

```bash
# 1. å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
npm run dev

# 2. è®¿é—®å„é¡µé¢
# http://localhost:3000/           # å‰§æœ¬æ¦‚è§ˆ
# http://localhost:3000/scripts    # å‰§æœ¬ç®¡ç†
# http://localhost:3000/ratings    # è¯„åˆ†è®°å½•
# http://localhost:3000/rankings   # å‰§æœ¬æ’è¡Œ

# 3. æµ‹è¯•åŠŸèƒ½
# - å‰§æœ¬åˆ—è¡¨åˆ†é¡µ
# - Tabåˆ‡æ¢ç­›é€‰
# - æœç´¢å‰§æœ¬
# - å¤šé€‰çŠ¶æ€ç­›é€‰
# - åˆ›å»º/ç¼–è¾‘/åˆ é™¤å‰§æœ¬
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

- Spring Bootå®˜æ–¹æ–‡æ¡£: https://spring.io/projects/spring-boot
- MyBatiså®˜æ–¹æ–‡æ¡£: https://mybatis.org/mybatis-3/
- Vue 3å®˜æ–¹æ–‡æ¡£: https://cn.vuejs.org/
- Arco Design Vue: https://arco.design/vue/
- FastJSONå®˜æ–¹æ–‡æ¡£: https://github.com/alibaba/fastjson

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜,è¯·æ£€æŸ¥:
1. Javaç‰ˆæœ¬æ˜¯å¦ä¸ºJDK 1.8
2. MySQLç‰ˆæœ¬æ˜¯å¦â‰¥5.7
3. Node.jsç‰ˆæœ¬æ˜¯å¦â‰¥16
4. æ˜¯å¦ä¸¥æ ¼éµå®ˆå¼€å‘è§„èŒƒ

---

**é‡æ„å®Œæˆå,è¯·åˆ é™¤åŸ Hono é¡¹ç›®,å…¨é¢åˆ‡æ¢åˆ°æ–°æ¶æ„ã€‚**
